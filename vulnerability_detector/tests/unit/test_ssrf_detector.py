from detectors.ssrf_detector import SSRFDetector
from config.config import Config


def detector():
    return SSRFDetector(Config())


def test_ssrf_risky_code():
    """Ensures the detector finds SSRF vulnerability in dangerous code."""
    php = "<?php $data = file_get_contents($_GET['url']); ?>"
    vulns = detector().analyze_php_file(php, "fetch.php")
    assert vulns and "Potential SSRF vulnerability" in vulns[0]["description"]


def test_ssrf_safe_code():
    """Ensures the detector ignores safe code without external requests."""
    php = """<?php echo 'no external fetch'; ?>"""
    assert detector().analyze_php_file(php, "plain.php") == []
