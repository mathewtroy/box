import os
import sys
from rich.console import Console
from rich.panel import Panel
from rich.text import Text

# Add the base directory to sys.path
base_dir = os.path.dirname(os.path.abspath(__file__))
sys.path.append(base_dir)

from static.cryptographic_failures_detect import run_cryptographic_failures_test
from static.injection_detect import run_injection_test
from static.insecure_design_detect import run_insecure_design_test
from static.identification_authentication_detect import run_identification_authentication_test
from static.logging_monitoring_detect import run_logging_monitoring_test
from static.ssrf_detect import run_ssrf_test
from dynamic.dynamic_injection_detect import run_dynamic_injection_test

# Initialize rich console
console = Console(force_terminal=True)


def print_section(title, color):
    """Print section titles with rich formatting."""
    console.print(Text(f"Checking for {title}...", style=color))


def main():
    console.print(
        Panel(
            "[bold magenta]Vulnerability Detector[/bold magenta]",
            border_style="cyan",
        )
    )

    # Cryptographic Failures
    print_section("Cryptographic Failures", "cyan")
    run_cryptographic_failures_test()
    console.print("[bold green]Cryptographic Failures Test Completed![/bold green]")
    console.print("-" * 40)

    # Injection (XSS) Vulnerabilities
    print_section("Injection (XSS) Vulnerabilities", "cyan")
    run_injection_test()
    console.print("[bold green]Injection (XSS) Test Completed![/bold green]")
    console.print("-" * 40)

    # Insecure Design Issues
    print_section("Insecure Design Issues", "cyan")
    run_insecure_design_test()
    console.print("[bold green]Insecure Design Test Completed![/bold green]")
    console.print("-" * 40)

    # Identification and Authentication Issues
    print_section("Identification and Authentication Issues", "cyan")
    run_identification_authentication_test()
    console.print("[bold green]Identification and Authentication Test Completed![/bold green]")
    console.print("-" * 40)

    # Logging and Monitoring Issues
    print_section("Logging and Monitoring Issues", "cyan")
    run_logging_monitoring_test()
    console.print("[bold green]Logging and Monitoring Test Completed![/bold green]")
    console.print("-" * 40)

    # SSRF Issues
    print_section("SSRF Issues", "cyan")
    run_ssrf_test()
    console.print("[bold green]SSRF Test Completed![/bold green]")
    console.print("-" * 40)

    # Dynamic XSS Vulnerability Test
    print_section("Dynamic XSS Vulnerability Test", "cyan")
    run_dynamic_injection_test()
    console.print("[bold green]Dynamic XSS Test Completed![/bold green]")
    console.print("-" * 40)

    console.print(
        Panel(
            "[bold green]Vulnerability Detection Completed[/bold green]",
            border_style="bright_blue",
        )
    )
