<?php
session_start();

$hostname = 'localhost';
$username = 'root';
$password = '';
$database = 'user-db';

// Create connection
$conn = new mysqli($hostname, $username, $password, $database);

// Check connection
if ($conn->connect_error) {
  die("We apologize. Database is not working.
  We will fix the problem in the near future." .
  $conn->connect_error);
}

// $login = '';
// $firstname = '';
// $email = '';
$formIsSent =  isset($_POST['do_reg']);

if($formIsSent) {
   
   $firstname =  $_POST['firstname'];
   $email =  $_POST['email'];
   $login =  $_POST['login'];
   $pass = $_POST['password'];
   $cpass = $_POST['cpassword'];
   $user_type = $_POST['user_type'];

   $select = " SELECT * FROM users WHERE email = '$email' ";
   $select_login = " SELECT * FROM users WHERE login = '$login' ";
   $result = mysqli_query($conn, $select);
   $result_login = mysqli_query($conn, $select_login);

   // Check unique email address
   if(mysqli_num_rows($result) > 0){
      $error = 'This email is already used!';

   // Check unique login
   }else if(mysqli_num_rows($result_login) > 0){
      $error = 'This login is already used!';

   }else {
      // Check password
      if($pass != $cpass){
         $error = 'Password is not matched!';
      } else {
         
         $insert = "INSERT INTO users(login, firstname, email, password, user_type) 
                    VALUES('$login', '$firstname', '$email', '$pass', '$user_type')";

         mysqli_query($conn, $insert);
         // everything is OK, I can work with data
         // perhaps create a new user in the DB
         header('location:../controllers/login.php');
         // exit;
         }
        
 
   }

};

?>
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>register form</title>
      <!-- Swiper css link  -->
      <link rel="stylesheet"
      href="https://unpkg.com/swiper@7/swiper-bundle.min.css">

      <!-- Font awesome cdn link  -->
      <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.4.0/css/all.min.css">

      <!-- Custom main css file link  -->
      <link rel="stylesheet" href="/secure/public/css/style.css">

      <!-- Custom footer css file link  -->
      <link rel="stylesheet" href="/secure/public/css/style-footer.css">

      <!-- Media queries  -->
      <link rel="stylesheet" href="/secure/public/css/media.css">

      <!-- Custom js file link  -->
      <script src="/secure/public/js/script.js"></script>

   </head>

   <body>

        <div class="form-container" id="registration">

           <form
           action=""
           class="form"
           id="form"
           method="post">

              <h3>Register now</h3>

              <div class="form-control">

                 <label for="login">Login</label>
                 <p class="inform">Use only Lowercase Latin letter and digits, min. 4
                    characters, max. 20 characters</p>
                 <input type="text"
                 name="login"
                 placeholder="Enter login (Required)"
                 id="login">
              </div>

              <div class="form-control">
                 <label for="firstname">Firstname</label>
                 <p class="inform">Use only Latin letter, min. 2 characters,
                    max. 20 characters</p>
                 <input type="text"
                 name="firstname"
                 placeholder="Enter firstname (Required)"
                 id="firstname">
              </div>

              <div class="form-control">
                 <label for="email">Email</label>
                 <p class="inform">Use an email like - example@mail.cz, do not use special
                    characters</p>
                 <input type="text"
                 name="email"
                 placeholder="Enter email (Required)"
                 id="email">
              </div>

              <div class="form-control">
                 <label for="password">Password</label>
                 <p class="inform">Use at least 1 digit, 1 Lowercase and 1 Uppercase
                    Latin letter,min. 6 characters, max. 60 characters</p>
                 <input type="password"
                 name="password"
                 placeholder="Enter password (Required)"
                 id="password">
              </div>

              <div class="form-control">
                 <label for="password">Password check</label>
                 <p class="inform">Use the same password</p>
                 <input type="password"
                 name="cpassword"
                 placeholder="Confirm password (Required)"
                 id="cpassword">
              </div>

              <div class="form-control">
                 <label>Type of user</label>
                 <select name="user_type">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                 </select>
              </div>

              <input type="submit" name="do_reg" value="register now" class="form-btn">

              <p class="redirect">Already have an account?
                 <a href="../controllers/login.php">
                    <i class="fas fa-sign-in-alt"></i> Login</a>
              </p>

              <p class="redirect"> Go to Website
                 <a href="../models/home.php">
                 <i class="fas fa-home"></i> Home</a>
              </p>
           </form>
        </div>
   </body>
</html>