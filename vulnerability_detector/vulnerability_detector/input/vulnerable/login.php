<?php
session_start();

$hostname = 'localhost';
$username = 'root';
$password = '';
$database = 'user-db';

// Create connection
$conn = new mysqli($hostname, $username, $password, $database);

// Check connection
if ($conn->connect_error) {
  die("We apologize. Database is not working. 
  We will fix the problem in the near future." . 
  $conn->connect_error);
}


$loginFormIsSent =  isset($_POST['do_login']);
$login = '';

if($loginFormIsSent) {
      
   $login =  $_POST['login'];
   $pass = $_POST['password'];

   // take login from Database
   $select = " SELECT * FROM users WHERE login = '$login' ";

   // take password from Database
   $select_password = " SELECT * FROM users WHERE password = '$pass' ";

   // check True или False (login) 
   $result_login = mysqli_query($conn, $select);
 
   // check True или False (password)
   $result_password = mysqli_query($conn, $select_password);
 
   $num = mysqli_num_rows($result_login);
   $num_pass = mysqli_num_rows($result_password);

 
   // password and login are True    
   if( $num == 1) {

      while ($row = mysqli_fetch_assoc($result_login)) {
         if ($pass == $row['password']) {
            $login = true;

            if($row['user_type'] == 'admin') {
               $_SESSION['admin_name'] = $row['firstname'];
               header('location:../models/admin_page.php');
      
            } elseif($row['user_type'] == 'user') {
               $_SESSION['user_name'] = $row['firstname'];
               header('location:../models/user_page.php');
            }
         }
         if ( $num_pass != 1) { $error = 'Incorrect Password!'; }
      }

   } else { $error = 'Incorrect Login! Try it again'; }

} 
?>
<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>login form</title>
      <!-- Swiper css link  -->
      <link rel="stylesheet" 
      href="https://unpkg.com/swiper@7/swiper-bundle.min.css">

      <!-- Font awesome cdn link  -->
      <link rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.4.0/css/all.min.css">

      <!-- Custom main css file link  -->
      <link rel="stylesheet" href="/secure/public/css/style.css"> 

      <!-- Custom footer css file link  -->
      <link rel="stylesheet" href="/secure/public/css/style-footer.css">

      <!-- Media queries  -->
      <link rel="stylesheet" href="/secure/public/css/media.css">  

      <!-- Custom js file link  -->
      <script src="/secure/public/js/script.js"></script>

   </head>

   <body>
      
   <div class="form-container">
      <form  
         action=""
         class="login_form"
         id="login_form" 
         method="post"> 

         <h3>login now</h3>

         <div class="form-control">
            <label for="login">Login</label>
            <p class="inform">Use only Lowercase Latin letter and digits, min. 4 
               characters, max. 20 characters</p>
            <input type="text" 
            name="login"  
            placeholder="Enter login (Required)" 
            id="login">
         </div>

         <div class="form-control">
            <label for="password">Password</label>
            <p class="inform">Use at least 1 digit, 1 Lowercase and 1 Uppercase 
               Latin letter,min. 6 characters, max. 60 characters</p> 
            <input type="password" 
            name="password" 
            placeholder="Enter password (Required)"
            id="password">
         </div>

         <input type="submit" name="do_login" value="login now" class="form-btn">
         
         <p class="redirect">Do not have an account? 
            <a href="../controllers/register.php">
               <i class="fas fa-user-plus"></i> Register</a>
         </p>
         
         <p class="redirect"> Go to Website
            <a href="../models/home.php">
            <i class="fas fa-home"></i> Home</a>
         </p>
      </form>

   </div>
   </body>
</html>